<!DOCTYPE HTML>
<html>

<head>
  <link rel="stylesheet" href="style/style.css" >
  
  <meta charset="utf-8">
</head>

<body>
  <div class="container">
  
    <div class="header">
      <div class="header__add-event">Добавить</div>
    </div>

	  <div class="month">
      <div class="month__button month__button_prev"></div>
      <div class="month__now"></div>
      <div class="month__button month__button_next"></div>
    </div>
	
    <div class="calendar"></div>


    <div class="add-event-form">      
      <button class="add-event-form__close">x</button>        
      <form>
          <input type="text" name="event-date" class="add-event-form__event-name" placeholder="ДД.ММ.ГГГГ" />
        
          <input type="text" class="add-event-form__event-name" name="event-title" placeholder="Событие" >
        
          <input type="text" name="event-members" class="add-event-form__event-name" placeholder="Имена участников" />
          <br><br><br>
          <textarea name="event-description" class="add-event-form__event-name"  placeholder="Описание"  rows="8"></textarea>

          <input type="button" data-action="addEvent" value="Готово"/>
          <input type="button" data-action="deleteEvent" value="Удалить"/>
        
        </form>  
      
    </div>

	
  </div>
  <script>
    function createCalendar(id, year, month) {
	
	    var dNow = new Date();
	  
	    if (month === undefined){	    
		    month = dNow.getMonth() + 1;
	    }	
	    year = year || dNow.getFullYear();	  
	  
      var elem = document.getElementsByClassName(id)[0];
	    var elemMonth = document.getElementsByClassName('month__now')[0];

      var mon = month - 1;
      	  // месяцы в JS идут от 0 до 11, а не от 1 до 12
      var d = new Date(year, mon);
	    var dPrev = new Date(year, mon);
	  	  
	    var weekday = ["Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"];
	    var monthName = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
	  
	    elemMonth.innerHTML = '' + monthName[d.getMonth()] + ' ' + d.getFullYear() + '';	  
	  
      var table = '<table><tr>';	  

      // заполнить первый ряд от понедельника
      // и до дня, с которого начинается месяц
      // * * * | 1  2  3  4
      for (var i = 0; i < getDay(d); i++) {	  
	      dPrev.setDate(dPrev.getDate() - getDay(d));
        table += '<td><span style="float:left; color: #8c8c8c;">' + weekday[getDay(dPrev)] + ', </span><div class="calendar__day-prev calendar__day_grey"> ' + dPrev.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		    dPrev.setDate(dPrev.getDate() + getDay(d) + 1);		
      }

      // ячейки календаря с датами и днями недели
      while (d.getMonth() == mon) {	 	  	
        if (dNow.getDate() == d.getDate() && dNow.getMonth() == d.getMonth() && dNow.getFullYear() == d.getFullYear()) {
		      table += '<td class="calendar_strong"><span style="float:left; color: #362d26;">' + weekday[getDay(dPrev)] + ', </span><div class="calendar__day"> ' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		    }  else {	    
		      table += '<td><span style="float:left; color: #362d26;">' + weekday[getDay(dPrev)] + ', </span><div class="calendar__day"> ' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
        }		
		    if (getDay(d) == 6) { // вс, последний день - перевод строки
          table += '</tr><tr>'; d.setDate(d.getDate() + 1); break;	  
        }
        d.setDate(d.getDate() + 1);		
      }

	    // ячейки календаря с датами
	    while (d.getMonth() == mon) {	 
        if (dNow.getDate() == d.getDate() && dNow.getMonth() == d.getMonth() && dNow.getFullYear() == d.getFullYear()) {
		      table += '<td class="calendar_strong"><div class="calendar__day">' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		    } else {	  	  
	        table += '<td><div class="calendar__day">'  + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
        }		
        if (getDay(d) == 6) { // вс, последний день - перевод строки
          table += '</tr><tr>';
		    } 
        d.setDate(d.getDate() + 1);
		    }	  	  

      // добить таблицу ячейками с днями следующего месяца
      if (getDay(d) != 0) {
        for (var i = getDay(d); i < 7; i++) {
          table += '<td><div class="calendar__day-next calendar__day_grey">' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		      d.setDate(d.getDate() + 1);
        }
      }	   
	    // закрыть таблицу
      table += '</tr></table>';      
	  
      // присваивание innerHTML
      elem.innerHTML = table;


      // переход на следующий/предыдущий месяц
      var elemNextMonth = document.getElementsByClassName('month__button_next')[0];
      var elemPrevMonth = document.getElementsByClassName('month__button_prev')[0];	
	  
	    function getPrevMonth() {	  
	      d.setMonth(d.getMonth() - 2);	  
	      createCalendar('calendar', d.getFullYear(), d.getMonth() + 1);
        
      }	
	
	    function getNextMonth() {
	      createCalendar('calendar', d.getFullYear(), d.getMonth() + 1);
      }
	
	    elemPrevMonth.onclick = getPrevMonth;
	    elemNextMonth.onclick = getNextMonth;      

      // вывод события в календаре
      eventObj.getEvent(d.getFullYear(), d.getMonth());  


    }



	
	  function getDay(date) { // получить номер дня недели, от 0(пн) до 6(вс)
      var day = date.getDay();
      if (day == 0) day = 7;
      return day - 1;
    }	


    // объект событий
    var eventObj = {       
      eventList: [ // массив событий
        {date: [12, 07, 2017], title: "День рождения", members: "Петр", description: "Д.Р у друга" 
        },      
        {date: [19, 06, 2017], title: "Митинг", members: "В.П. и Д.М.", description: "Митинг на Болотной" 
        },      
        {date: [23, 07, 2017], title: "Свадьба", members: "Иван и Мария", description: "Свадьба у друга" 
        },      
        {date: [29, 08, 2017], title: "Встреча выпускников", members: "сокурсники", description: "Встреча выпускников института" 
        }
      ],
       
      getEvent: function (year, month) {  // метод вывода события в календаре       
        var calendarTodoList = document.getElementsByClassName('calendar__todo-list');
        var calendarDay = document.getElementsByClassName('calendar__day');
      
        for (var i = 0; i < this.eventList.length; i++) {
          if (this.eventList[i].date[2] == year && this.eventList[i].date[1] == month) { 
            for (var j = 0; j < calendarDay.length; j++) {           
              if (calendarDay[j].innerHTML == +this.eventList[i].date[0]) {
              calendarDay[j].nextElementSibling.innerHTML = this.eventList[i].title + ',<br>' + this.eventList[i].members;
              calendarDay[j].parentElement.classList.add('calendar_marked'); break;
              }
            } 
          }   
        }
      },

      addEvent: function() {// метод добавления события в календарь
        var eventDate = document.getElementsByName('event-date')[0].value;
        var eventDateRow = eventDate.split('.');
        var eventTitle = document.getElementsByName('event-title')[0].value;
        var eventMembers = document.getElementsByName('event-members')[0].value;
        var eventDescription = document.getElementsByName('event-description')[0].value;
        
        this.eventList.push({date: eventDateRow , title: eventTitle, members: eventMembers, description: eventDescription});

        createCalendar('calendar');              
      },

      deleteEvent: function() {// метод удаления события из календаря        
        alert( 'Удаляю' );         
      }

    };

    // Открытие окна добавления события
    var headerAddEvent = document.getElementsByClassName('header__add-event')[0];
    headerAddEvent.onclick = function() {
      addEventForm.style.display = 'block';
    }

    // скрытие окна добавления события
    var addEventFormClose = document.getElementsByClassName('add-event-form__close')[0];
    addEventFormClose.onclick = function() {
      addEventForm.style.display = '';
    }


    // добавление/удаление события календаре
    var addEventForm = document.getElementsByClassName('add-event-form')[0];
    addEventForm.onclick = function(e) {
      var target = e.target;
      var action = target.getAttribute('data-action');
      if (action) {  
        eventObj[action]();
        addEventForm.style.display = '';
      }
    }; 


    
    
    createCalendar('calendar'); 


    
    

      

  </script>
</body>

</html>