<!DOCTYPE HTML>
<html>

<head>
  <link rel="stylesheet" href="style/style.css" >
  
  <meta charset="utf-8">
</head>

<body>
  <div class="container">
  
    <div class="header"></div> 
	<div class="month"><div class="month__button month__button_prev"></div><div class="month__now"></div><div class="month__button month__button_next"></div></div>
	
    <div class="calendar"></div>
	
  </div>
  <script>
    function createCalendar(id, year, month) {
	
	    var dNow = new Date();
	  
	    if (month === undefined){	    
		    month = dNow.getMonth() + 1;
	    }	
	    year = year || dNow.getFullYear();	  
	  
      var elem = document.getElementsByClassName(id)[0];
	    var elemMonth = document.getElementsByClassName('month__now')[0];

      var mon = month - 1;
      	  // месяцы в JS идут от 0 до 11, а не от 1 до 12
      var d = new Date(year, mon);
	    var dPrev = new Date(year, mon);
	  	  
	    var weekday = ["Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"];
	    var monthName = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
	  
	    elemMonth.innerHTML = '' + monthName[d.getMonth()] + ' ' + d.getFullYear() + '';	  
	  
      var table = '<table><tr>';	  

      // заполнить первый ряд от понедельника
      // и до дня, с которого начинается месяц
      // * * * | 1  2  3  4
      for (var i = 0; i < getDay(d); i++) {	  
	      dPrev.setDate(dPrev.getDate() - getDay(d));
        table += '<td><div class="calendar__day calendar__day_grey">' + weekday[getDay(dPrev)] + ', ' + dPrev.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		    dPrev.setDate(dPrev.getDate() + getDay(d) + 1);		
      }

      // ячейки календаря с датами и днями недели
      while (d.getMonth() == mon) {	 	  	
        if (dNow.getDate() == d.getDate() && dNow.getMonth() == d.getMonth() && dNow.getFullYear() == d.getFullYear()) {
		      table += '<td class="calendar_strong"><div class="calendar__day"><strong>' + weekday[getDay(d)] + ', ' + d.getDate() + '</strong></div><div class="calendar__todo-list"></div></td>';
		    }  else {	    
		      table += '<td><div class="calendar__day">' + weekday[getDay(d)] + ', ' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
        }		
		    if (getDay(d) == 6) { // вс, последний день - перевод строки
          table += '</tr><tr>'; d.setDate(d.getDate() + 1); break;	  
        }
        d.setDate(d.getDate() + 1);		
      }

	    // ячейки календаря с датами
	    while (d.getMonth() == mon) {	 
        if (dNow.getDate() == d.getDate() && dNow.getMonth() == d.getMonth() && dNow.getFullYear() == d.getFullYear()) {
		      table += '<td class="calendar_strong"><div class="calendar__day"><strong>' + d.getDate() + '</strong></div><div class="calendar__todo-list"></div></td>';
		    } else {	  	  
	        table += '<td><div class="calendar__day">'  + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
        }		
        if (getDay(d) == 6) { // вс, последний день - перевод строки
          table += '</tr><tr>';
		    } 
        d.setDate(d.getDate() + 1);
		    }	  	  

      // добить таблицу ячейками с днями следующего месяца
      if (getDay(d) != 0) {
        for (var i = getDay(d); i < 7; i++) {
          table += '<td><div class="calendar__day calendar__day_grey">' + d.getDate() + '</div><div class="calendar__todo-list"></div></td>';
		      d.setDate(d.getDate() + 1);
        }
      }	   
	    // закрыть таблицу
      table += '</tr></table>';      
	  
      // присваивание innerHTML
      elem.innerHTML = table;


      // переход на следующий/предыдущий месяц
      var elemNextMonth = document.getElementsByClassName('month__button_next')[0];
      var elemPrevMonth = document.getElementsByClassName('month__button_prev')[0];	
	  
	    function getPrevMonth() {	  
	      d.setMonth(d.getMonth() - 2);	  
	      createCalendar('calendar', d.getFullYear(), d.getMonth() + 1);
        
      }	
	
	    function getNextMonth() {
	      createCalendar('calendar', d.getFullYear(), d.getMonth() + 1);
      }
	
	    elemPrevMonth.onclick = getPrevMonth;
	    elemNextMonth.onclick = getNextMonth;      

      // вывод события в календаре
      eventObj.getEvent(d.getFullYear(), d.getMonth());  
          	  
    }



	
	  function getDay(date) { // получить номер дня недели, от 0(пн) до 6(вс)
      var day = date.getDay();
      if (day == 0) day = 7;
      return day - 1;
    }	


    // объект событий
    var eventObj = {       
      eventList: [ // массив событий
        {date: [12, 07, 2017], title: "День рождения", members: "Петр", description: "Д.Р у друга" 
        },      
        {date: [19, 06, 2017], title: "Митинг", members: "В.П. и Д.М.", description: "Митинг на Болотной" 
        },      
        {date: [23, 07, 2017], title: "Свадьба", members: "Иван и Мария", description: "Свадьба у друга" 
        },      
        {date: [29, 08, 2017], title: "Встреча выпускников", members: "сокурсники", description: "Встреча выпускников института" 
        }
      ],
       
      getEvent: function (year, month) {  // метод вывода события в календаре       
        var calendarTodoList = document.getElementsByClassName('calendar__todo-list');
        var calendarDay = document.getElementsByClassName('calendar__day');
      
        for (var i = 0; i < this.eventList.length; i++) {
          if (this.eventList[i].date[2] === year && this.eventList[i].date[1] === month) { 
            for (var j = 0; j < calendarDay.length; j++) {            
              if (calendarDay[j].innerHTML == this.eventList[i].date[0]) {
              calendarDay[j].nextElementSibling.innerHTML = this.eventList[i].title + ',<br>' + this.eventList[i].members;
              calendarDay[j].parentElement.classList.add('calendar_marked');
              }
            } 
          }   
        }
      },

      setEvent: function() {// метод добавления события в календарь
        //this.event.push({date: [20, 08, 2017], title: "Отпуск", members: "Жена", description: "В Геленджик"});
      }

    };

    // добавление события в календаре
      //eventObj.setEvent();



    createCalendar('calendar');    

  </script>
</body>

</html>